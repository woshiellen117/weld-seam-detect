var wfAjax=new WFAjax();var workfowFlashDialog=null;function removeWorkflowMatchResultCache(){try{return wfAjax.removeWorkflowMatchResultCache(matchRequestToken)}catch(A){alert(A.message)}}function canTakeBack(C,H,G,D,B,A,E){try{if($("#workflow_node_condition_input")[0]){$("#workflow_node_condition_input")[0].value='{"matchRequestToken":"'+matchRequestToken+'"}'}return wfAjax.canTakeBack(A,H,G,C)}catch(F){alert(F.message)}}function canStopFlow(A){try{if($("#workflow_node_condition_input")[0]){$("#workflow_node_condition_input")[0].value='{"matchRequestToken":"'+matchRequestToken+'"}'}return wfAjax.canStopFlow(A)}catch(B){alert(B.message)}}function canRepeal(A,D,C){try{if($("#workflow_node_condition_input")[0]){$("#workflow_node_condition_input")[0].value='{"matchRequestToken":"'+matchRequestToken+'"}'}return wfAjax.canRepeal(A,D,C)}catch(B){alert(B.message)}}function canStepBack(B,G,F,A,C,D){try{if($("#workflow_node_condition_input")[0]){$("#workflow_node_condition_input")[0].value='{"matchRequestToken":"'+matchRequestToken+'"}'}D=D==undefined?"":D;C=C==undefined?"":C;return wfAjax.canStepBack(B,A,G,F,C,D)}catch(E){alert(E.message)}}function lockWorkflowForStepBack(C,A,J,L,O,H,I,F,G,K,M,P,R,Q,N,E,D){if($("#workflow_node_condition_input")[0]){$("#workflow_node_condition_input")[0].value='{"matchRequestToken":"'+matchRequestToken+'"}'}D=D==undefined?"":D;E=E==undefined?"":E;var B=new Object();B.formData=M;B.mastrid=M;B.processTemplateId=F;B.processId=G;B.caseId=J;B.currentActivityId=K;B.currentWorkitemId=A;B.currentUserId=C;B.bussinessId=H;B.affairId=I;B.appName=P;B.formAppId=R;B.formId=Q;B.formOperationId=N;B.matchRequestToken=matchRequestToken;return wfAjax.lockWorkflowForStepBack(B,L,O,E,D)}function canTemporaryPending(A){try{if($("#workflow_node_condition_input")[0]){$("#workflow_node_condition_input")[0].value='{"matchRequestToken":"'+matchRequestToken+'"}'}return wfAjax.canTemporaryPending(A)}catch(B){alert(B.message)}}function canSubmitWorkFlow(A){if(null!=A&&A!=""&&A!="-1"){return wfAjax.canWorkflowCurrentNodeSubmit(A)}return null}function lockWorkflow(E,B,C){try{var A=wfAjax.lockWorkflow(E,B,C);if(A==null){A=new Array("false",$.i18n("workflow.wapi.exception.msg002"))}return A}catch(D){alert(D.message)}}function lockWorkflowUseNowexpirationTime(F,C,D,B){try{var A=wfAjax.lockWorkflow(F,C,D,B);if(A==null){A=new Array("false",$.i18n("workflow.wapi.exception.msg002"))}return A}catch(E){alert(E.message)}}function releaseWorkflow(C,A){try{return wfAjax.releaseWorkflow(C,A)}catch(B){alert(B.message)}}function releaseWorkflowByAction(D,A,B){try{return wfAjax.releaseWorkflow(D,A,B)}catch(C){alert(C.message)}}function checkWorkflowLock(D,B){try{var A=wfAjax.checkWorkflowLock(D,B);if(A==null){A=new Array("false",$.i18n("workflow.wapi.exception.msg002"))}return A}catch(C){alert(C.message)}}function checkWorkflowLock(E,B,C){try{var A=wfAjax.checkWorkflowLock(E,B,C);if(A==null){A=new Array("false",$.i18n("workflow.wapi.exception.msg002"))}return A}catch(D){alert(D.message)}}function _closeFlashDialogBeforeOpen(A){if(workfowFlashDialog){workfowFlashDialog.isHide=false;workfowFlashDialog.close(workfowFlashDialog.index)}else{if($("#workflow_dialog_workflowDesigner_Id",A.document).size()>0){A.$("#workflow_dialog_workflowDesigner_Id_mask").remove();A.$("#workflow_dialog_workflowDesigner_Id").remove()}}}function _closeOrHideFlashDialog(){if(!$.browser.msie){workfowFlashDialog.close()}else{workfowFlashDialog.hideDialog()}}function createWFTemplate(O,J,G,Q,N,M,D,C,H,B,L,I,F,A,E,K){var P=O;if(M){P=M}_closeFlashDialogBeforeOpen(O);setTimeout(function(){K=K==undefined?"":K;var S=$(O).width();var T=$(O).height();if(S<=0){S=$(document.body).width();T=$(document.body).height()}var R=_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=0&isModalDialog=true";R=R+"&formApp="+G+"&formName="+Q+"&appName="+J+"&processId="+N+"&currentUserId="+C;R=R+"&currentUserName="+escapeSpecialChar(encodeURIComponent(H));R=R+"&currentUserAccountName="+escapeSpecialChar(encodeURIComponent(B));R=R+"&defaultPolicyId="+escapeSpecialChar(encodeURIComponent(D));R=R+"&defaultPolicyName="+escapeSpecialChar(encodeURIComponent(A));R=R+"&flowPermAccountId="+L;R=R+"&operationName="+I;R=R+"&startOperationName="+F;R=R+"&wendanId="+(E||"-1");R=R+"&isvalidate=false&oldPTId="+K;R=R+"&isTemplate=true";workfowFlashDialog=$.dialog({id:"workflow_dialog_workflowDesigner_Id",isHide:true,url:R,width:S-20,height:T-100,title:$.i18n("workflow.designer.title"),targetWindow:O,transParams:{subProcessJson:$("#process_subsetting",P.document).val(),formId:$("#formId").val(),dwidths:S,dheights:T-20,workflowRule:$("#process_rulecontent",P.document).val(),returnValueWindow:P},closeParam:{show:true,handler:function(){if(typeof recoverWorkFlowHistoryData=="function"){recoverWorkFlowHistoryData()}}},minParam:{show:false},maxParam:{show:false},notCopyReturnValue:true,buttons:[{text:$.i18n("workflow.designer.page.button.ok"),isEmphasize:true,handler:function(){var U=workfowFlashDialog.getReturnValue({innerButtonId:"ok"});if(U){initDialogDataToParentPage(U,P,O);_closeOrHideFlashDialog();if(typeof finishWorkFlowModify=="function"){finishWorkFlowModify()}}}},{text:$.i18n("workflow.designer.page.button.cancel"),handler:function(){_closeOrHideFlashDialog();if(typeof recoverWorkFlowHistoryData=="function"){recoverWorkFlowHistoryData()}}}]})},10)}function modifyWFTemplateForEgg(L,M,D,K,A,J,O,B,R,C,I,Q,H,P){var F=L;if(J){F=J}var E=$("#process_xml",currentTr).val();var G=$("#process_subsetting",currentTr).val();G=G==undefined?"":G;var N=wfAjax.validateProcessTemplateXMLForEgg(M,A,E,D,K,H,Q,G);_closeFlashDialogBeforeOpen(L);setTimeout(function(){var U=$("#process_id",currentTr).val();U=U==undefined?"":U;var S=$(L).width();var T=$(L).height();if(S<=0){S=$(document.body).width();T=$(document.body).height()}$("#process_xml",currentTr).val(N[0]);$("#process_subsetting",currentTr).val(N[3]);$("#process_xml",F.document).val(N[0]);$("#process_subsetting",F.document).val(N[3]);workfowFlashDialog=$.dialog({id:"workflow_dialog_workflowDesigner_Id",isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=0&isModalDialog=true&formApp="+D+"&formName="+K+"&appName="+M+"&processId="+A+"&currentUserId="+B+"&currentUserName="+escapeSpecialChar(encodeURIComponent(R))+"&currentUserAccountName="+escapeSpecialChar(encodeURIComponent(C))+"&defaultPolicyId="+escapeSpecialChar(encodeURIComponent(O))+"&defaultPolicyName="+escapeSpecialChar(encodeURIComponent(P))+"&flowPermAccountId="+I+"&operationName="+Q+"&startOperationName="+H+"&isvalidateSub=true&oldPTId="+U,width:S-20,height:T-100,title:$.i18n("workflow.designer.title"),targetWindow:L,transParams:{subProcessJson:$("#process_subsetting",currentTr).val(),formId:$("#formId").val(),dwidths:S,dheights:T-20,workflowRule:$("#process_rulecontent",currentTr).val(),returnValueWindow:F,verifyResultXml:N[1]},closeParam:{show:true,handler:function(){if(typeof recoverWorkFlowHistoryData=="function"){recoverWorkFlowHistoryData()}}},minParam:{show:false},maxParam:{show:false},notCopyReturnValue:true,buttons:[{text:$.i18n("workflow.designer.page.button.ok"),isEmphasize:true,handler:function(){var V=workfowFlashDialog.getReturnValue({innerButtonId:"ok"});if(V){var X=wfAjax.validateFormTemplate(M,D||"",V[1],V[4]);if(X==null||X.length<2){$.alert($.i18n("workflow.label.dialog.validateError.js"));return }if("false"==X[0]){if($("#needRedirect",currentTr)[0]){$("#needRedirect",currentTr).val("true")}var Z=$($.parseXML(X[1].substr(38)));var e=Z.find("n[s=false]");var W=true,h="";if(e.size()>0){loopFlag1:for(var b=0,c=e.size();b<c;b++){var Y=e.eq(b);for(var a=0;a<5;a++){if("false"==Y.find("r"+a).text()){W=false;h=Y.find("r"+a+"msg").text();break loopFlag1}}}}var f=Z.find("l[s=false]");if(W&&f.size()>0){loopFlag2:for(var b=0,c=f.size();b<c;b++){var d=f.eq(b);if("false"==d.find("r0").text()){W=false;h=d.find("r0msg").text();break loopFlag2}}}var g=Z.find("cl[s=false]");if(W&&g.size()>0){loopFlag2:for(var b=0,c=g.size();b<c;b++){var d=g.eq(b);if("false"==d.find("r0").text()){W=false;h=d.find("r0msg").text();break loopFlag2}}}Z=e=f=Y=d=g=null;if(!W){$.alert(h);return }}initDialogDataToParentPage4egg(V,F,L);if($("#needRedirect",currentTr)[0]){$("#needRedirect",currentTr).val("false")}_closeOrHideFlashDialog();if(typeof finishWorkFlowModify=="function"){finishWorkFlowModify()}}}},{text:$.i18n("workflow.designer.page.button.cancel"),handler:function(){_closeOrHideFlashDialog();if(typeof recoverWorkFlowHistoryData=="function"){recoverWorkFlowHistoryData()}}}]})},10)}function initDialogDataToParentPage4egg(V,H,S){var B=V[0];var E=V[1];var P=V[2];var U=V[3];var D=V[4];var N=V[5];var L=$("#process_desc_by",currentTr)[0];var I=$("#process_xml",currentTr)[0];var A=$("#value4Show",currentTr)[0];var O=$("#process_rulecontent",currentTr)[0];var Q=$("#process_subsetting",currentTr)[0];var F=$("#process_event",currentTr)[0];if(!L&&B){showFlashAlert("Error: not found process_desc_by input element in parent page!");throw new Error("Error: not found process_desc_by input element in parent page!")}if(!I&&E){showFlashAlert("Error: not found process_xml input element in parent page!");throw new Error("Error: not found process_xml input element in parent page!")}if(!A&&P){showFlashAlert("Error: not found process_info input element in parent page!");throw new Error("Error: not found process_info input element in parent page!")}if(!O&&U){alert("Error: not found process_rulecontent input element in parent page!");throw new Error("Error: not found process_rulecontent input element in parent page!")}if(!Q&&D){showFlashAlert("Error: not found process_subsetting input element in parent page!");throw new Error("Error: not found process_subsetting input element in parent page!")}if(B){L.value=B}if(E){I.value=E}if(P){A.value=P;$(A).trigger("propertychange").trigger("input");try{$("#process_info").tokenInput("destroy")}catch(T){}}try{O.value=(U==undefined||U==null)?"":U}catch(T){}if(D){Q.value=D}if(F){F.value=N}try{var C=$("#process_desc_by",currentTr)[0];var R=$("#process_xml",currentTr)[0];var M=$("#value4Show",currentTr)[0];var J=$("#process_rulecontent",currentTr)[0];var K=$("#process_subsetting",currentTr)[0];var G=$("#process_event",currentTr)[0];C.value=B;R.value=E;M.value=P;J.value=U;K.value=D;G.value=N;afterValueChange()}catch(T){}}function cloneWFTemplate(L,M,F,K,A,J,N,B,R,D,I,Q,H,O,C,E){var P=wfAjax.selectProcessTemplateXMLForClone(M,A,F,C||"-1",E||"-1","{}");if(P==null||P.length<2){$.alert($.i18n("workflow.label.dialog.cloneFailure.js"));return }var G=L;if(J){G=J}_closeFlashDialogBeforeOpen(L);setTimeout(function(){var S=$("#process_xml",G.document).val();var V=$("#process_id",G.document).val();V=V==undefined?"":V;$("#process_xml",G.document).val(P[0]);var T=$(L).width();var U=$(L).height();if(T<=0){T=$(document.body).width();U=$(document.body).height()}workfowFlashDialog=$.dialog({id:"workflow_dialog_workflowDesigner_Id",isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=0&isModalDialog=true&formApp="+F+"&formName="+K+"&appName="+M+"&processId=&currentUserId="+B+"&currentUserName="+escapeSpecialChar(encodeURIComponent(R))+"&currentUserAccountName="+escapeSpecialChar(encodeURIComponent(D))+"&defaultPolicyId="+escapeSpecialChar(encodeURIComponent(N))+"&defaultPolicyName="+escapeSpecialChar(encodeURIComponent(O))+"&flowPermAccountId="+I+"&operationName="+Q+"&startOperationName="+H+"&wendanId="+(E||"-1")+"&isvalidate=false&oldPTId="+V,width:T-20,height:U-100,title:$.i18n("workflow.designer.title"),targetWindow:L,transParams:{subProcessJson:$("#process_subsetting",G.document).val(),formId:$("#formId").val(),dwidths:T,dheights:U-20,workflowRule:$("#process_rulecontent",G.document).val(),returnValueWindow:G,verifyResultXml:P[1],isClone:true,appName:M,formApp:F},closeParam:{show:true,handler:function(){$("#process_xml",G.document).val(S);if(typeof recoverWorkFlowHistoryData=="function"){recoverWorkFlowHistoryData()}}},minParam:{show:false},maxParam:{show:false},notCopyReturnValue:true,buttons:[{text:$.i18n("workflow.designer.page.button.ok"),isEmphasize:true,handler:function(){var W=workfowFlashDialog.getReturnValue({innerButtonId:"ok"});if(W){var Y=wfAjax.validateFormTemplate(M,F||E||"",W[1],W[4]);if(Y==null||Y.length<2){$.alert($.i18n("workflow.label.dialog.validateError.js"));return }if("false"==Y[0]){var a=$($.parseXML(Y[1].substr(38)));var f=a.find("n[s=false]");var X=true,j="";if(f.size()>0){loopFlag1:for(var c=0,d=f.size();c<d;c++){var Z=f.eq(c);for(var b=0;b<5;b++){if("false"==Z.find("r"+b).text()){X=false;j=Z.find("r"+b+"msg").text();break loopFlag1}}}}var g=a.find("l[s=false]");if(X&&g.size()>0){loopFlag2:for(var c=0,d=g.size();c<d;c++){var e=g.eq(c);if("false"==e.find("r0").text()){X=false;j=e.find("r0msg").text();break loopFlag2}}}var h=a.find("cl[s=false]");if(X&&h.size()>0){loopFlag3:for(var c=0,d=h.size();c<d;c++){var e=h.eq(c);if("false"==e.find("r0").text()){X=false;j=e.find("r0msg").text();break loopFlag3}}}a=f=g=Z=h=e=null;if(!X){j="<div style='width:270px;' class='word_break_all'>"+j+"<div>";$.alert(j);return }}initDialogDataToParentPage(W,G,L);_closeOrHideFlashDialog();if(typeof finishWorkFlowModify=="function"){finishWorkFlowModify()}}}},{text:$.i18n("workflow.designer.page.button.cancel"),handler:function(){$("#process_xml",G.document).val(S);_closeOrHideFlashDialog();if(typeof recoverWorkFlowHistoryData=="function"){recoverWorkFlowHistoryData()}}}]})},10)}function initDialogDataToParentPage(V,H,S){var B=V[0];var E=V[1];var P=V[2];var U=V[3];var D=V[4];var N=V[5];var L=$("#process_desc_by",H.document)[0];var I=$("#process_xml",H.document)[0];var A=$("#process_info",H.document)[0];var O=$("#process_rulecontent",H.document)[0];var Q=$("#process_subsetting",H.document)[0];var F=$("#process_event",H.document)[0];if(!L&&B){showFlashAlert("Error: not found process_desc_by input element in parent page!");throw new Error("Error: not found process_desc_by input element in parent page!")}if(!I&&E){showFlashAlert("Error: not found process_xml input element in parent page!");throw new Error("Error: not found process_xml input element in parent page!")}if(!A&&P){showFlashAlert("Error: not found process_info input element in parent page!");throw new Error("Error: not found process_info input element in parent page!")}if(!O&&U){alert("Error: not found process_rulecontent input element in parent page!");throw new Error("Error: not found process_rulecontent input element in parent page!")}if(!Q&&D){showFlashAlert("Error: not found process_subsetting input element in parent page!");throw new Error("Error: not found process_subsetting input element in parent page!")}if(B){L.value=B}if(E){I.value=E}if(P){$("#process_info",H.document).attr("value",P);$("#process_info",H.document).trigger("propertychange").trigger("input");try{$("#process_info",H.document).tokenInput("destroy");if(typeof (hideCommonContact)!="undefined"){hideCommonContact()}}catch(T){}$("#process_info",H.document).attr("value",P)}try{O.value=(U==undefined||U==null)?"":U}catch(T){}if(D){Q.value=D}if(F){F.value=N}try{var C=$("#process_desc_by",S.document)[0];var R=$("#process_xml",S.document)[0];var M=$("#process_info",S.document)[0];var J=$("#process_rulecontent",S.document)[0];var K=$("#process_subsetting",S.document)[0];var G=$("#process_event",S.document)[0];C.value=B;R.value=E;M.value=P;J.value=U;K.value=D;G.value=N}catch(T){}}function createWFPersonal(J,G,D,F,C,B,I,E,H,A){var K=J;if(I){K=I}_closeFlashDialogBeforeOpen(J);setTimeout(function(){var L=$(getCtpTop()).width();var M=$(getCtpTop()).height();workfowFlashDialog=J.$.dialog({id:"workflow_dialog_workflowDesigner_Id",isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=1&isModalDialog=true&processId="+B+"&appName="+G+"&currentUserId="+D+"&currentUserName="+escapeSpecialChar(encodeURIComponent(F))+"&currentUserAccountName="+escapeSpecialChar(encodeURIComponent(C))+"&defaultPolicyId="+escapeSpecialChar(encodeURIComponent(E))+"&defaultPolicyName="+escapeSpecialChar(encodeURIComponent(A))+"&flowPermAccountId="+H,width:L-20,height:M-100,title:$.i18n("workflow.designer.title"),targetWindow:getCtpTop(),transParams:{dwidths:L,dheights:M,returnValueWindow:K},minParam:{show:false},maxParam:{show:false},notCopyReturnValue:true,buttons:[{text:$.i18n("workflow.designer.page.button.ok"),isEmphasize:true,handler:function(){var N=workfowFlashDialog.getReturnValue({innerButtonId:"ok"});if(N){initDialogDataToParentPage(N,K,J);try{getCtpTopFromOpener(window).distroy_token=true}catch(O){}_closeOrHideFlashDialog();if(getA8Top().location.href.indexOf("a8genius.do")!=-1){window.resizeTo(L,M)}}}},{text:$.i18n("workflow.designer.page.button.cancel"),handler:function(){_closeOrHideFlashDialog();if(getA8Top().location.href.indexOf("a8genius.do")!=-1){window.resizeTo(L,M)}}}]})},10)}function showWFTDiagram(F,D,H,E,G,A,C){A=A||"";C=C||"";var B=F;if(H){B=H}_closeFlashDialogBeforeOpen(F);setTimeout(function(){E=E==undefined?"":E;G=G==undefined?"":G;var J=$(F).width();var K=$(F).height();if(J<=0){J=$(document.body).width();K=$(document.body).height()}var I=_wfctxPath+"/workflow/designer.do?method=showDiagram&isTemplate=true&isDebugger=false&scene=2&isModalDialog=true&processId="+D+"&currentUserAccountName="+escapeSpecialChar(encodeURIComponent(G))+"&appName="+A+"&wendanId="+C;if(E!=""){I=I+"&currentUserName="+escapeSpecialChar(encodeURIComponent(E))}workfowFlashDialog=$.dialog({id:"workflow_dialog_workflowDesigner_Id",isHide:true,url:I,width:J-30,height:K-100,title:$.i18n("workflow.designer.title.readonly"),transParams:{dwidths:J,dheights:K-20,returnValueWindow:B},minParam:{show:false},maxParam:{show:false},notCopyReturnValue:true,buttons:[{text:$.i18n("workflow.designer.page.button.close"),handler:function(){_closeOrHideFlashDialog()}}],targetWindow:F})},10)}function showWFCDiagram(N,D,A,H,I,F,K,J,L,B,P,M,G,C,E){C=C||false;E=E||"";var O=N;if(K){O=K}if(J==null){$.alert("please pass the argument appName (the 8th parameter of showWFCDiagram)")}_closeFlashDialogBeforeOpen(N);setTimeout(function(){var S=$(N).width();var T=$(N).height();if(S<=0){S=$(document.body).width();T=$(document.body).height()}var R=$.i18n("workflow.designer.title.readonly");if(M&&M!=""){R=M}var Q="";if(G&&G!=""){Q=G}workfowFlashDialog=$.dialog({id:"workflow_dialog_workflowDesigner_Id",isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=3&isModalDialog=true&processId="+A+"&caseId="+D+"&isTemplate="+H+"&showHastenButton="+I+"&superviseId="+F+"&appName="+J+"&currentNodeId="+B+"&formMutilOprationIds="+P+"&currentUserName="+encodeURIComponent(Q)+"&isHistoryFlag="+C+"&wendanId="+E,width:S-30,height:T-100,title:R,transParams:{dwidths:S,dheights:T-20,returnValueWindow:O},minParam:{show:false},maxParam:{show:false},notCopyReturnValue:true,buttons:[{text:$.i18n("workflow.designer.page.button.close"),handler:function(){_closeOrHideFlashDialog();if(L&&typeof L=="function"){L()}}}],targetWindow:N})},10)}function superviousWFCDiagram(M,F,B,G,J,H,K,E,A,L,D){D=D||false;var I=wfAjax.getCaseState(F);var C=I[0]=="true"?true:false;var N=M;if(J){N=J}_closeFlashDialogBeforeOpen(M);setTimeout(function(){var O;if(!C){O=lockWorkflow(B,_wfcurrentUserId,0);if(O[0]=="false"){C=true}}var Q=$(M).width();var R=$(M).height();if(Q<=0){Q=$(document.body).width();R=$(document.body).height()}var P=$.i18n("workflow.designer.title");if(L&&L!=""){P=L}workfowFlashDialog=$.dialog({id:"workflow_dialog_workflowDesigner_Id",isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=3&isModalDialog=true&showHastenButton=false&processId="+B+"&caseId="+F+"&isTemplate="+G+"&appName="+H+"&flowPermAccountId="+K+"&defaultPolicyId="+escapeSpecialChar(encodeURIComponent(E))+"&defaultPolicyName="+escapeSpecialChar(encodeURIComponent(A))+"&isHistoryFlag="+D,width:Q-20,height:R-100,title:P,transParams:{dwidths:Q,dheights:R-20,returnValueWindow:N},minParam:{show:false},maxParam:{show:false},closeParam:{show:true,handler:function(){if(!C){releaseWorkflowByAction(B,_wfcurrentUserId,0)}}},targetWindow:M,notCopyReturnValue:true,buttons:[{id:"modifyButton",text:$.i18n("workflow.designer.page.button.modify"),disabled:C,handler:function(){var T=workfowFlashDialog.getReturnValue({innerButtonId:"supervious_modify"});if(T){var W=T[0];var X=T[1];var V=T[2];var U=T[3];var S=T[4];W.refreshMonitor(X,V,U,S,1,true,4);workfowFlashDialog.showBtn("okButton").removeClass("common_button_gray").addClass("common_button_emphasize");workfowFlashDialog.hideBtn("modifyButton")}}},{id:"okButton",hide:true,btnType:1,text:$.i18n("workflow.designer.page.button.ok"),handler:function(){var S=workfowFlashDialog.getReturnValue({innerButtonId:"supervious_ok"});if(S){_closeOrHideFlashDialog();if(!C){releaseWorkflowByAction(B,_wfcurrentUserId,0)}}}},{text:$.i18n("workflow.designer.button.close"),handler:function(){_closeOrHideFlashDialog();if(!C){releaseWorkflowByAction(B,_wfcurrentUserId,0)}}}]});if(O&&O[0]&&O[0]=="false"){$.alert(O[1])}},10)}function editWFCDiagramEdocModalDialog(O,F,B,L,J,H,M,E,A,Q,I,N,D){D=D||false;var G=lockWorkflow(B,_wfcurrentUserId,2,D);if(G[0]=="false"){I=(I==undefined||I==true)?true:false;if(I){$.alert(G[1])}else{alert(G[1])}return }var K=wfAjax.getCaseState(F);var C=K[0]=="true"?true:false;var P=O;if(L){P=L}_closeFlashDialogBeforeOpen(O);setTimeout(function(){var S=$(O).width();var U=$(O).height();if(S<=0){S=$(document.body).width();U=$(document.body).height()}var R=$.i18n("workflow.designer.title");if(N&&N!=""){R=N}if(!I){if($.browser.chrome){var T=v3x.openDialog({id:"password_new_Win",title:R,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=4&isModalDialog=true&processId="+B+"&caseId="+F+"&isTemplate="+H+"&appName="+J+"&flowPermAccountId="+M+"&defaultPolicyId="+escapeSpecialChar(encodeURIComponent(E))+"&defaultPolicyName="+escapeSpecialChar(encodeURIComponent(A))+"&isEdoc=true&dialogTitle="+escapeSpecialChar(encodeURIComponent(R))+"&isHistoryFlag="+D,width:S-100,height:U-50,minParam:{show:false},maxParam:{show:false},closeParam:{show:true,handler:function(){if(!$.browser.msie){T.close()}else{T.hideDialog()}releaseWorkflowByAction(B,_wfcurrentUserId,2)}},targetWindow:O,notCopyReturnValue:true,buttons:[{id:"okButton",text:$.i18n("workflow.designer.page.button.ok"),disabled:C,handler:function(){var W=T.getReturnValue({innerButtonId:"supervious_ok"});if(W){if(!$.browser.msie){T.close()}else{T.hideDialog()}releaseWorkflowByAction(B,_wfcurrentUserId,2);if(Q&&typeof Q=="function"){Q()}}}},{text:$.i18n("workflow.designer.page.button.cancel"),handler:function(){if(!$.browser.msie){T.close()}else{T.hideDialog()}releaseWorkflowByAction(B,_wfcurrentUserId,2)}}]})}else{var V=getA8Top().v3x.openWindow({url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=4&isModalDialog=false&processId="+B+"&caseId="+F+"&isTemplate="+H+"&appName="+J+"&flowPermAccountId="+M+"&defaultPolicyId="+escapeSpecialChar(encodeURIComponent(E))+"&defaultPolicyName="+escapeSpecialChar(encodeURIComponent(A))+"&isEdoc=true&dialogTitle="+escapeSpecialChar(encodeURIComponent(R))+"&isHistoryFlag="+D,width:S-10,height:U,resizable:"no"});releaseWorkflowByAction(B,_wfcurrentUserId,2);if(Q&&typeof Q=="function"){Q()}}}else{workfowFlashDialog=$.dialog({id:"workflow_dialog_workflowDesigner_Id",isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=4&isModalDialog=true&processId="+B+"&caseId="+F+"&isTemplate="+H+"&appName="+J+"&flowPermAccountId="+M+"&defaultPolicyId="+escapeSpecialChar(encodeURIComponent(E))+"&defaultPolicyName="+escapeSpecialChar(encodeURIComponent(A))+"&isHistoryFlag="+D,width:S-20,height:U-100,title:R,transParams:{dwidths:S,dheights:U-20,returnValueWindow:P},minParam:{show:false},maxParam:{show:false},closeParam:{show:true,handler:function(){releaseWorkflowByAction(B,_wfcurrentUserId,2)}},targetWindow:O,notCopyReturnValue:true,buttons:[{id:"okButton",text:$.i18n("workflow.designer.page.button.ok"),disabled:C,handler:function(){var W=workfowFlashDialog.getReturnValue({innerButtonId:"supervious_ok"});if(W){_closeOrHideFlashDialog();releaseWorkflowByAction(B,_wfcurrentUserId,2);if(Q&&typeof Q=="function"){Q()}}}},{text:$.i18n("workflow.designer.page.button.cancel"),handler:function(){_closeOrHideFlashDialog();releaseWorkflowByAction(B,_wfcurrentUserId,2)}}]})}},10)}function editWFCDiagram(J,D,B,G,F,E,H,C,A,K,I){editWFCDiagramEdocModalDialog(J,D,B,G,F,E,H,C,A,K,true,I)}function adminWFCDiagram(M,G,B,H,L,I,O,F,K,E,A,D){D=D||false;var J=wfAjax.getCaseState(G);var C=J[0]=="true"?true:false;var N=M;if(L){N=L}_closeFlashDialogBeforeOpen(M);setTimeout(function(){var P;if(!C){P=lockWorkflow(B,_wfcurrentUserId,1);if(P[0]=="false"){C=true}}var Q=$(M).width();var R=$(M).height();if(Q<=0){Q=$(document.body).width();R=$(document.body).height()}workfowFlashDialog=$.dialog({id:"workflow_dialog_workflowDesigner_Id",isHide:true,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=3&isModalDialog=true&isst=false&processId="+B+"&caseId="+G+"&isTemplate="+H+"&appName="+I+"&flowPermAccountId="+K+"&defaultPolicyId="+escapeSpecialChar(encodeURIComponent(E))+"&defaultPolicyName="+escapeSpecialChar(encodeURIComponent(A))+"&isHistoryFlag="+D,width:Q-20,height:R-100,title:$.i18n("workflow.designer.title"),transParams:{dwidths:Q,dheights:R-20,returnValueWindow:N},minParam:{show:false},maxParam:{show:false},closeParam:{show:true,handler:function(){if(!C){releaseWorkflowByAction(B,_wfcurrentUserId,1)}}},targetWindow:M,notCopyReturnValue:true,buttons:[{id:"modifyButton",text:$.i18n("workflow.designer.page.button.modify"),isEmphasize:true,disabled:C,handler:function(){var T=workfowFlashDialog.getReturnValue({innerButtonId:"supervious_modify"});if(T){var W=T[0];var X=T[1];var V=T[2];var U=T[3];var S=T[4];W.refreshMonitor(X,V,U,S,1,true,5);workfowFlashDialog.showBtn("okButton");workfowFlashDialog.hideBtn("modifyButton");workfowFlashDialog.disabledBtn("repealButton");workfowFlashDialog.disabledBtn("stopButton")}}},{id:"okButton",hide:true,btnType:1,text:$.i18n("workflow.designer.page.button.ok"),handler:function(){var S=workfowFlashDialog.getReturnValue({innerButtonId:"supervious_ok"});if(S){_closeOrHideFlashDialog();if(!C){releaseWorkflowByAction(B,_wfcurrentUserId,1)}}}},{id:"repealButton",text:$.i18n("workflow.designer.page.button.repeal"),disabled:C,handler:function(){var S=canRepeal(I,B,"");if(S[0]=="false"){$.alert(S[1]);return }if(typeof O=="function"){O(M,G,B,H,L,I,workfowFlashDialog)}else{alert("Error: cannot find function repealWorkflow(tWindow,caseId,processId,isTemplate,vWindow,appName,dialog), please define it!")}}},{id:"stopButton",text:$.i18n("workflow.designer.page.button.stop"),disabled:C,handler:function(){if(typeof F=="function"){F(M,G,B,H,L,I,workfowFlashDialog)}else{alert("Error:cannot find function stopWorkflow(tWindow,caseId,processId,isTemplate,vWindow,appName,dialog), please define it!")}}},{text:$.i18n("workflow.designer.button.close"),handler:function(){_closeOrHideFlashDialog();if(!C){releaseWorkflowByAction(B,_wfcurrentUserId,1)}}}]});if(P&&P[0]&&P[0]=="false"){$.alert(P[1])}},10)}function confirmCircleBackSubmit(G,E,B,F,D,C){var A=$.confirm({msg:G,ok_fn:function(){if(typeof (E)!="undefined"&&E!=null){E.close()}stepBackToTargetNodeCallBackNodialog(B,C.processId,C.caseId,C.currentActivityId,F,D,"1")},cancel_fn:function(){A.close();try{releaseApplicationButtons()}catch(H){}}})}function preSendOrHandleWorkflow(Q,A,H,J,N,C,L,D,P,R,K,O,F,M,E,I){var G=Q;if(O){G=O}var B=new Object();B.appName=R;B.processXml=K;B.processId=J;B.caseId=L;B.currentActivityId=N;B.currentWorkitemId=A;B.currentUserId=C;B.currentAccountId=D;B.formData=P;B.mastrid=P;B.debugMode=false;B.processTemplateId=H;B.currentWorkItemIsInSpecial=M;B.matchRequestToken=matchRequestToken;B.useNowexpirationTime=I;preDoWFNew(Q,B,null,G,F,J,A,E)}function validateCircleOperation(A,I,E,B,D,G,F,H){var C=wfAjax.validateCurrentSelectedNode(A.caseId,I,"",A.currentActivityId,A.processXml,A.currentAccountId,"collaboration",A.processId);if(C[0]=="true"){if(E=="true"){if(C[2]=="true"||C[8]=="true"){confirmGo($.i18n("workflow.special.circleback.alert7.js"),F,G);return }else{if(D.indexOf("1")==-1){confirmCircleBackSubmit($.i18n("workflow.special.circleback.alert8.js"),G,B,I,"1",A);return }}}else{if(C[2]=="true"||C[8]=="true"){if(D.indexOf("0")==-1){confirmCircleBackSubmit($.i18n("workflow.special.circleback.alert12.js"),G,B,I,"0",A);return }}}}if(C[13]=="true"){confirmGo($.i18n("workflow.special.circleback.alert13.js"),F,G);return }if(C[12]=="true"){confirmGo($.i18n("workflow.special.circleback.alert4.js"),F,G);return }else{if(C[11]=="true"){confirmGo($.i18n("workflow.special.circleback.alert11.js"),F,G);return }else{if(C[3]=="true"){confirmGo($.i18n("workflow.special.circleback.alert1.js"),F,G);return }else{if(C[4]=="true"){confirmGo($.i18n("workflow.special.circleback.alert2.js"),F,G);return }else{if(C[5]=="true"){confirmGo($.i18n("workflow.special.circleback.alert3.js"),F,G);return }else{if(C[6]=="true"){if(C[9]=="true"){confirmGo($.i18n("workflow.special.circleback.alert4.js"),F,G)}else{confirmGo($.i18n("workflow.special.circleback.alert5.js"),F,G)}return }else{if(C[7]=="true"){confirmGo($.i18n("workflow.special.circleback.alert6.js"),F,G);return }else{if(typeof (G)!="undefined"&&G!=null){G.close()}stepBackToTargetNodeCallBackNodialog(B,A.processId,A.caseId,A.currentActivityId,I,D,"1",H)}}}}}}}}function confirmGo(D,C,B){var A=$.confirm({msg:D,ok_fn:function(){A.close();if(typeof (B)!="undefined"&&B!=null){B.close()}C()},cancel_fn:function(){A.close();try{releaseApplicationButtons()}catch(E){}}})}function preDoWFNew(U,p,k,b,T,J,W,L){p.isValidate="true";var o=new Object();if(k){o=k}else{o=new Object();var H=new Array();var S=new Array();var f=new Array();o.allNotSelectNodes=H;o.allSelectNodes=S;o.allSelectInformNodes=f}o.pop=false;o.token="";o.last="false";o.alreadyChecked="false";var c=wfAjax.transBeforeInvokeWorkFlow(p,o)||{};var K=c.pop;var n=c.token;var q=c.canSubmit;var D=c.circleNodes;var N=c.isInSpecialStepBackStatus;var j=c.toReGo;var E=c.dynamicFormMasterIds;var V=c.humenNodeMatchAlertMsg;if(V&&V!=""){$.alert(V);try{releaseApplicationButtons()}catch(l){}return }if(n&&n=="WORKFLOW"){}else{$.alert($.i18n("workflow.wapi.exception.msg002"));try{releaseApplicationButtons()}catch(l){}return }if(q=="false"){var Z=c.cannotSubmitMsg;$.alert(Z);try{releaseApplicationButtons()}catch(l){}return }var P=b.document;var h=$("#workflow_last_input",P)[0];if(h){h.value=c.last}var G=$("#toReGo",P)[0];if(G){G.value=j}var Y=$("#dynamicFormMasterIds",P)[0];if(Y&&E){Y.value=E}var B=c.invalidateActivityMap||{};var X=true;var d="";$(c.allSelectNodes).each(function(e,s){var t=B[s];var r=(t!=null&&t.trim()!="")?true:false;if(r){X=false;d+=(d!=null&&d.trim()=="")?t:"\u3001"+t}});if(!X){$.alert($.i18n("workflow.invalidateActivity.label",d));if(J!=""&&W!=null&&W!="-1"&&W!="0"){releaseWorkflowByAction(J,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(l){}return }var F=function(){if(K==true){var y=c.hasSubProcess;var s="";if(y){s=$.i18n("workflow.commonpage.branchpeoplenewflow.select")}else{s=$.i18n("workflow.commonpage.branchpeoplenewflow.select1")}var t=$.dialog({id:"workflow_dialog_showWorkFlowMatchResultPage_Id",url:_wfctxPath+"/workflow/designer.do?method=showWorkFlowMatchResultPage",width:740,height:400,title:s,isFromModle:true,targetWindow:getCtpTop(),closeParam:{show:true,handler:function(){releaseWorkflowByAction(J,_wfcurrentUserId,14);removeWorkflowMatchResultCache();try{releaseApplicationButtons()}catch(z){}}},transParams:{context:p,cpMatchResult:c,isNeedCheckLevelScope:true},notCopyReturnValue:true,buttons:[{text:$.i18n("common.button.ok.label"),isEmphasize:true,handler:function(){var AB=$("#workflow_newflow_input",b.document)[0];if(!AB){showFlashAlert('Error : no hidden input <input type="hidden" name="workflow_newflow_input" id="workflow_newflow_input">  in the page!');if(J!=""&&W!=null&&W!="-1"&&W!="0"){releaseWorkflowByAction(J,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(AE){}return false}var AA=$("#workflow_node_peoples_input",b.document)[0];if(!AA){showFlashAlert('Error : no hidden input <input type="hidden" name="workflow_node_peoples_input" id="workflow_node_peoples_input"> in the page!');if(J!=""&&W!=null&&W!="-1"&&W!="0"){releaseWorkflowByAction(J,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(AE){}return false}var AD=$("#workflow_node_condition_input",b.document)[0];if(!AD){showFlashAlert('Error:no hidden input <input type="hidden" name="workflow_node_condition_input" id="workflow_node_condition_input"> in the page!');if(J!=""&&W!=null&&W!="-1"&&W!="0"){releaseWorkflowByAction(J,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(AE){}return false}var AC=t.getReturnValue({innerButtonId:"ok"});if(AC){if(AC[0]==""){AC[0]='{"matchRequestToken":"'+matchRequestToken+'"}'}else{AC[0]='{"matchRequestToken":"'+matchRequestToken+'",'+AC[0].substring(1)}$("#workflow_node_condition_input",b.document)[0].value=AC[0];$("#workflow_node_peoples_input",b.document)[0].value=AC[1];$("#workflow_newflow_input",b.document)[0].value=AC[2];if($("#workflow_last_input",b.document)[0]){$("#workflow_last_input",b.document)[0].value=AC[3]}t.close();var z=p.caseId;if(z==null||z.trim()==""||z.trim()=="-1"){if(typeof T=="function"){T()}else{if($.content.callback.workflowNew){$.content.callback.workflowNew()}else{showFlashAlert("Error : cannot find submit function workflowNew()!");if(J!=""&&W!=null&&W!="-1"&&W!="0"){releaseWorkflowByAction(J,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(AE){}return }}}else{if(z!=null&&z.trim()!=""&&z.trim()!="-1"&&p.currentActivityId=="start"){if(typeof T=="function"){T()}else{if($.content.callback.workflowNew){$.content.callback.workflowNew()}else{showFlashAlert("Error : cannot find submit function workflowNew()!");if(J!=""&&W!=null&&W!="-1"&&W!="0"){releaseWorkflowByAction(J,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(AE){}return }}}else{if(typeof T=="function"){T()}else{if($.content.callback.workflowFinish){$.content.callback.workflowFinish()}else{showFlashAlert("Error : cannot find submit function workflowFinish()!");if(J!=""&&W!=null&&W!="-1"&&W!="0"){releaseWorkflowByAction(J,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(AE){}return }}}}}else{if(J!=""&&W!=null&&W!="-1"&&W!="0"){releaseWorkflowByAction(J,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(AE){}return false}}},{text:$.i18n("common.button.cancel.label"),handler:function(){try{var AA;if($.browser.mozilla){AA=document.getElementById("zwIframe").contentWindow}else{AA=document.zwIframe}if(AA&&typeof AA.deleteContentById=="function"){AA.deleteContentById()}AA=null}catch(z){}$("#workflow_newflow_input",b.document)[0].value="";$("#workflow_node_peoples_input",b.document)[0].value="";$("#workflow_node_condition_input",b.document)[0].value="";t.close();if(J!=""&&W!=null&&W!="-1"&&W!="0"){releaseWorkflowByAction(J,_wfcurrentUserId,14)}removeWorkflowMatchResultCache();try{releaseApplicationButtons()}catch(z){}}}]})}else{var w=$("#workflow_node_condition_input",b.document)[0];if(!w){showFlashAlert('Error : cannot find hidden input <input type="hidden" name="workflow_node_condition_input" id="workflow_node_condition_input"> in the page');if(J!=""&&W!=null&&W!="-1"&&W!="0"){releaseWorkflowByAction(J,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(x){}return false}var u="";$(c.allSelectNodes).each(function(e,z){if(e==0){u+='{"condition":[';u+='{"nodeId":"'+z+'",';u+='"isDelete":"false"}'}else{u+=',{"nodeId":"'+z+'",';u+='"isDelete":"false"}'}});if(c.allNotSelectNodes&&c.allNotSelectNodes.length>0){var v=c.allNotSelectNodes.length-1;$(c.allNotSelectNodes).each(function(e,z){u+=',{"nodeId":"'+z+'",';u+='"isDelete":"true"}'})}if(u!=""){u+="]}"}if(u==""){u='{"matchRequestToken":"'+matchRequestToken+'"}'}else{u='{"matchRequestToken":"'+matchRequestToken+'",'+u.substring(1)}$("#workflow_node_condition_input",b.document)[0].value=u;var r=p.caseId;if(r==null||r.trim()==""||r.trim()=="-1"){if(typeof T=="function"){T()}else{if($.content.callback.workflowNew){$.content.callback.workflowNew()}else{showFlashAlert("Error : cannot find submit function workflowNew()!");if(J!=""&&W!=null&&W!="-1"&&W!="0"){releaseWorkflowByAction(J,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(x){}return }}}else{if(r!=null&&r.trim()!=""&&r.trim()!="-1"&&p.currentActivityId=="start"){if(typeof T=="function"){T()}else{if($.content.callback.workflowNew){$.content.callback.workflowNew()}else{showFlashAlert("Error : cannot find submit function workflowNew()!");if(J!=""&&W!=null&&W!="-1"&&W!="0"){releaseWorkflowByAction(J,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(x){}return }}}else{if(typeof T=="function"){T()}else{if($.content.callback.workflowFinish){$.content.callback.workflowFinish()}else{showFlashAlert("Error : cannot find submit function workflowFinish()!");if(J!=""&&W!=null&&W!="-1"&&W!="0"){releaseWorkflowByAction(J,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(x){}return }}}}}};var I=D!=null&&typeof (D)!="undefined"&&D.length>0;if(I){var g=p.currentWorkItemIsInSpecial;var C=(g==null||typeof (g)=="undefined"||g=="")?false:g;if(N=="true"&&!C){$.alert($.i18n("workflow.wapi.presend.alert.js"));releaseWorkflowByAction(J,_wfcurrentUserId,14);try{releaseApplicationButtons()}catch(l){}return }if(D.length==1&&D[0].submitStyle!="0,1"){var O=D[0];var m=O.nodeId;var R=O.submitStyle;var A=validateCircleOperation(p,m,N,W,R,null,F,1);return }else{var Q=(L==1)?' checked="checked" ':"";var a=(L==1||L==2)?' disabled="true" ':"";var M='<span id="traceSpanArea" style="display:none"><label for="trackWorkflow" class="margin_t_5 hand"><input type="checkbox" id="trackWorkflow" name="trackWorkflow" '+Q+a+' class="radio_com">'+$.i18n("collaboration.workflow.trace.traceworkflow")+'</label><span class="color_blue hand" style="color:#318ed9;" title="'+$.i18n("collaboration.workflow.trace.summaryDetail")+'">['+$.i18n("collaboration.workflow.trace.title")+"]</span></span>";var i=$.dialog({id:"workflow_dialog_showCircleBackSelectDialog_Id",url:_wfctxPath+"/workflow/designer.do?method=showCircleBackSelectDialog",width:740,height:400,title:$.i18n("workflow.commonpage.circleback.select.js"),isFromModle:true,bottomHTML:M,targetWindow:getCtpTop(),closeParam:{show:true,handler:function(){releaseWorkflowByAction(J,_wfcurrentUserId,14);try{releaseApplicationButtons()}catch(r){}}},transParams:{circleNodes:D,contextParam:p,isInSpecialStepBackStatus:N},notCopyReturnValue:true,buttons:[{text:$.i18n("common.button.ok.label"),isEmphasize:true,id:"ok",handler:function(){var s=i.getReturnValue();var u=s[0];var r=s[1];var t=s[2];var e=validateCircleOperation(p,u,N,W,r,i,F,t);return }},{text:$.i18n("common.button.cancel.label"),handler:function(){try{var s;if($.browser.mozilla){s=document.getElementById("zwIframe").contentWindow}else{s=document.zwIframe}if(s&&typeof s.deleteContentById=="function"){s.deleteContentById()}s=null}catch(r){}$("#workflow_newflow_input",b.document)[0].value="";$("#workflow_node_peoples_input",b.document)[0].value="";$("#workflow_node_condition_input",b.document)[0].value="";i.close();if(J!=""&&W!=null&&W!="-1"&&W!="0"){releaseWorkflowByAction(J,_wfcurrentUserId,14)}try{releaseApplicationButtons()}catch(r){}}}]})}}if(!I){F()}}function showFailedCondition(D,B){var C=false;var A=B==undefined?true:B;$("#workflow_select_people_or_branch tr[id='workflow_select_people_or_branch_template_ready']").each(function(J){var H=$("#workflow_branch_checkbox",$(this));var K=$("input",H).attr("checked");var F=$("input",H).attr("isSelect");var I=$("input",H).attr("defaultShow");if(K||F||I=="true"){$(this).css("display","")}else{C=true;var G=$(this).css("display");if(G=="none"){$(this).css("display","")}else{$(this).css("display","none")}}});if(C&&A){var E=$("#workflow_branch_show");if(D==0){E.html($.i18n("workflow.commonpage.branch.hide"))}else{E.html($.i18n("workflow.commonpage.branch.show"))}}}function selectPeople(A,B,E){var C=E;var F=1;var D=1;if(B=="1"){F=1}else{F=-1}$.selectPeople({type:"selectPeople",panels:"Department,Team,Post,RelatePeople,JoinOrganization",selectType:"Member",showFlowTypeRadio:false,maxSize:F,minSize:D,params:{value:""},callback:function(G){if(G.obj){A.value=G.text;A.title=G.text;$("#"+E).attr("value",getIdsString(G.obj,false))}}})}function getNamesString(E){if(!E){return""}var G=[];for(var C=0;C<E.length;C++){var F=E[C];var B=null;if(F.accountShortname){var A=document.getElementById("appName");var D=document.getElementById("orgAccountId");if(A&&A.value=="4"){if(F.type=="Account"||(D&&D.value==F.accountId)){B=F.name}else{B=F.accountShortname+F.name}}else{B=F.name+"("+F.accountShortname+")"}}else{B=F.name}G[G.length]=B}return G.join("\u3001")}function getIdsString(C,E){if(!C){return""}if(E==null){E=true}var D=[];for(var B=0;B<C.length;B++){var A=null;if(E){A=C[B].type+"|"+C[B].id}else{A=C[B].id}D[D.length]=A+(C[B].excludeChildDepartment?"|1":"")}return D.join(",")}function showSelectPeoplePart(B,A){if(B.checked){$("#node_"+A+"_peoples").css("display","")}else{$("#node_"+A+"_peoples").css("display","none")}}function showSubSelectPeoplePart(A,B){if(A.checked){$("#senderId_"+B).css("display","");$("#senderLabel_"+B).css("display","");$("#senderId_"+B+"Name").css("display","")}else{$("#senderId_"+B).css("display","none");$("#senderLabel_"+B).css("display","none");$("#senderId_"+B+"Name").css("display","none")}}function setSelectValue(B,A){$("#"+A).attr("value",B.value)}function showConditionDesc(B){var A=$("#"+B).val();A=A==""?$.i18n("workflow.label.empty2.js"):A;$("#"+B+"_a").tooltip({openAuto:true,msg:"<div class='font_size12'>"+A+"</div>"})}function getProcessChangeMessage(){return $("#processChangeMessage").val()}function setProcessChangeMessage(A){$("#processChangeMessage").val(A)}function insertNode(B,A,E,O,D,L,M,C,K,Q,J,G,F){var P=wfAjax.canChangeNode(B);if(P[0]=="false"){$.alert(P[1]);return }var H=lockWorkflow(A,_wfcurrentUserId,3);if(H[0]=="false"){$.alert(H[1]);return }if(!F){F=false}var N={};var I=$.dialog({url:_wfctxPath+"/workflow/process.do?method=preAddNodeToDiagram&appName="+L+"&isForm="+M+"&defaultPolicyId="+escapeSpecialChar(encodeURIComponent(C))+"&accountId="+K+"&processId="+A+"&nodeId="+E+"&caseId="+D+"&isTemplete="+F,transParams:{processId:A,nodeId:E,processXML:$("#process_xml").val(),dialogObj:N},width:635,height:500,title:$.i18n("workflow.insertPeople.title"),notCopyReturnValue:true,buttons:[{text:$.i18n("common.button.ok.label"),isEmphasize:true,handler:function(){try{var Y=I.getReturnValue();if(Y!=null&&Y.length>0){var R=$.parseJSON(Y);var T=$("#process_xml");if(T.size()<=0){$.alert("please define hidden input whitch id is process_xml in the page!");return }var U=T.val();var W="";var S=$("#process_message_data");if(S.size()>0){W=S.val()}R.summaryId=J;R.affairId=G;R.caseId=D;R.workitemId=B;var Z=wfAjax.addNode(A,E,E,O,1,R,U,"",W,getProcessChangeMessage());if("false"==Z[2]){$.alert(Z[3]);return }if(Z&&Z[0]){T.val(Z[0])}if(Z&&Z[4]&&S.size()>0){S.val(Z[4]);S=null}if(Z&&Z[5]){setProcessChangeMessage(Z[5])}T=null;var X={type:1,currentNodeId:E,names:R.userName,messageDataList:Z[4]};if(typeof Q=="function"){Q(X)}else{if(typeof refreshWorkflow=="function"){refreshWorkflow(X)}else{$.alert("\u8bf7\u6dfb\u52a0\u4e00\u4e2a\u540d\u5b57\u4e3arefreshWorkflow\u7684\u51fd\u6570\uff0c\u4ee5\u5237\u65b0\u6d41\u7a0b\u56fe\u9875\u9762\uff0c\u770b\u5230\u52a0\u7b7e/\u51cf\u7b7e\u6548\u679c\uff01")}}I.close()}else{$.alert($.i18n("workflow.least.select.one"));return }}catch(V){showFlashAlert(V.message)}}},{text:$.i18n("common.button.cancel.label"),handler:function(){I.close()}}],targetWindow:getCtpTop()});N.dialog=I}function assignNodeSelPerson(D,I,H,E,M,O,F,P,N,G,B,K,Q){var J=wfAjax.canChangeNode(D);if(J[0]=="false"){$.alert(J[1]);return }var C=lockWorkflow(I,_wfcurrentUserId,5);if(C[0]=="false"){$.alert(C[1]);return }var R=wfAjax.getAcountExcludeElements();var L=parseElements(R[0]);var A={type:"selectPeople",text:"${ctp:i18n('workflow.insertPeople.urgerAlt')}",showFlowTypeRadio:false,isConfirmExcludeSubDepartment:true,unallowedSelectEmptyGroup:true,excludeElements:L,params:{value:""},targetWindow:window.top,callback:function(Y){if(Y&&Y.obj&&Y.obj.length>0){var V={};var e=[],Z=[],X=[],c=[],f=[],a=[];var W=false,S=Y.obj;for(var T=0,U=S.length;T<U;T++){e.push(S[T].id);Z.push(S[T].name);X.push(S[T].type);c.push(S[T].excludeChildDepartment);f.push(S[T].accountId);a.push(S[T].accountShortname);if(S[T].type!="Member"){W=true}}V.userId=e;V.userName=Z;V.userType=X;V.userExcludeChildDepartment=c;V.accountId=f;V.accountShortname=a;V.policyId=P;V.policyName=Q;V.flowType="5";var d=[],b="all";var U=V.userType.length;for(var T=0;T<U;T++){d.push(b)}competionObj=null;V.node_process_mode=d;if(F){V.formOperationPolicy="1"}else{V.formOperationPolicy="0"}assignNodeOpe(D,I,H,E,M,O,F,P,N,G,B,K,V)}else{$("#collSelectPeopleInput").val("<${ctp:i18n('workflow.insertPeople.urgerAlt')}>")}}};if("${appName}"=="collaboration"||"${appName}"=="form"){A.panels="Department,Team,Post,Outworker,RelatePeople,JoinOrganization";A.selectType="Account,Member,Department,Team,Post,Outworker,RelatePeople"}else{A.panels="Department,Team,Post,RelatePeople";A.selectType="Account,Member,Department,Team,Post,RelatePeople"}$.selectPeople(A)}function assignNode(B,A,E,M,D,K,L,C,J,O,I,F){var N=wfAjax.canChangeNode(B);if(N[0]=="false"){$.alert(N[1]);return }var G=lockWorkflow(A,_wfcurrentUserId,5);if(G[0]=="false"){$.alert(G[1]);return }var H=$.dialog({url:_wfctxPath+"/workflow/process.do?method=preAssignNode&appName="+K+"&isForm="+L+"&defaultPolicyId="+escapeSpecialChar(encodeURIComponent(C))+"&accountId="+J+"&nodeId="+E,transParams:{processId:A,nodeId:E,processXML:$("#process_xml").val()},width:560,height:226,title:$.i18n("workflow.assignNode.assign"),notCopyReturnValue:true,buttons:[{text:$.i18n("common.button.ok.label"),isEmphasize:true,handler:function(){try{var P=H.getReturnValue();if(P!=null&&P.length>0){var R=$.parseJSON(P);assignNodeOpe(B,A,E,M,D,K,L,C,J,O,I,F,R);H.close()}else{$.alert($.i18n("workflow.least.select.one"));return }}catch(Q){showFlashAlert(Q.message)}}},{text:$.i18n("common.button.cancel.label"),handler:function(){H.close()}}],targetWindow:getCtpTop()})}function assignNodeOpe(C,L,J,D,P,S,E,T,Q,G,B,N,U){var O=$("#process_xml");var A=$("#readyObjectJSON");if(O.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=process_xml\u7684\u9690\u85cf\u57df\uff01");return }if(A.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=readyObjectJSON\u7684\u9690\u85cf\u57df\uff01");return }var R=O.val();var F=A.val();var K="";var H=$("#process_message_data");if(H.size()>0){K=H.val()}U.summaryId=B;U.affairId=N;U.caseId=P;var I=wfAjax.addNode(L,J,J,D,3,U,R,F,K,getProcessChangeMessage());if(I&&I[0]){O.val(I[0])}if(I&&I[1]){A.val(I[1])}if(I&&I[4]&&H.size()>0){H.val(I[4]);H=null}if(I&&I[5]){setProcessChangeMessage(I[5])}O=null;A=null;var M={type:3,currentNodeId:J,names:U.userName,messageDataList:I[4]};if(typeof G=="function"){G(M)}else{if(typeof refreshWorkflow=="function"){refreshWorkflow(M)}else{$.alert("\u8bf7\u6dfb\u52a0\u4e00\u4e2a\u540d\u5b57\u4e3arefreshWorkflow\u7684\u51fd\u6570\uff0c\u4ee5\u5237\u65b0\u6d41\u7a0b\u56fe\u9875\u9762\uff0c\u770b\u5230\u52a0\u7b7e/\u51cf\u7b7e\u6548\u679c\uff01")}}}function informNode(D,A,G,O,F,M,N,E,L,Q,K,H){var P=wfAjax.canChangeNode(D);if(P[0]=="false"){$.alert(P[1]);return }var I=lockWorkflow(A,_wfcurrentUserId,6);if(I[0]=="false"){$.alert(I[1]);return }var J=wfAjax.getAcountExcludeElements();var C=parseElements(J[0]);var B={type:"selectPeople",text:$.i18n("workflow.insertPeople.urgerAlt"),showFlowTypeRadio:false,isConfirmExcludeSubDepartment:true,unallowedSelectEmptyGroup:true,excludeElements:C,params:{value:""},targetWindow:getCtpTop(),callback:function(j){if(j&&j.obj&&j.obj.length>0){var Z=[],T=[],h=[],S=[],W=[],U=[],c=[];var g={};for(var d=0,e=j.obj.length;d<e;d++){Z.push(j.obj[d].id);T.push(j.obj[d].name);h.push(j.obj[d].type);S.push(j.obj[d].excludeChildDepartment);W.push(j.obj[d].accountId);U.push(j.obj[d].accountShortname);c.push("all")}g.userId=Z;g.userName=T;g.userType=h;g.userExcludeChildDepartment=S;g.accountId=W;g.accountShortname=U;g.flowType="5";g.node_process_mode=c;g.policyId=E;g.policyName=$.i18n("permission.operation.Infom");if(N){g.formOperationPolicy="0"}else{g.formOperationPolicy="1"}var b=$("#process_xml"),R=$("#readyObjectJSON");if(b.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=process_xml\u7684\u9690\u85cf\u57df\uff01");return }var f=b.val();var V=$("#process_message_data");var Y="";if(V.size()>0){Y=V.val()}g.summaryId=K;g.affairId=H;g.caseId=F;var X=wfAjax.addNode(A,G,G,O,2,g,f,"",Y,getProcessChangeMessage());if(X&&X[0]){b.val(X[0])}if(X&&X[4]&&V.size()>0){V.val(X[4]);V=null}if(X&&X[5]){setProcessChangeMessage(X[5])}b=null;var a={type:2,currentNodeId:G,names:g.userName,messageDataList:X[4]};if(typeof Q=="function"){Q(a)}else{if(typeof refreshWorkflow=="function"){refreshWorkflow(a)}else{$.alert("\u8bf7\u6dfb\u52a0\u4e00\u4e2a\u540d\u5b57\u4e3arefreshWorkflow\u7684\u51fd\u6570\uff0c\u4ee5\u5237\u65b0\u6d41\u7a0b\u56fe\u9875\u9762\uff0c\u770b\u5230\u52a0\u7b7e/\u51cf\u7b7e\u6548\u679c\uff01")}}}else{$("#collSelectPeopleInput").val("<"+$.i18n("workflow.insertPeople.urgerAlt")+">")}}};if(M=="collaboration"||M=="form"){B.panels="Department,Team,Post,Outworker,RelatePeople,JoinOrganization";B.selectType="Account,Member,Department,Team,Post,Outworker,RelatePeople"}else{B.panels="Department,Team,Post";B.selectType="Account,Member,Department,Team,Post"}$.selectPeople(B)}function deleteNode(B,A,D,I,C,K,H,E){var J=wfAjax.canChangeNode(B);if(J[0]=="false"){$.alert(J[1]);return }var F=lockWorkflow(A,_wfcurrentUserId,4);if(F[0]=="false"){$.alert(F[1]);return }var G=$.dialog({id:"workflow_dialog_prePreDeleteNodeFromDiagram",isFromModle:true,url:_wfctxPath+"/workflow/process.do?method=prePreDeleteNodeFromDiagram",transParams:{processId:A,nodeId:D,processXML:$("#process_xml").val()},width:400,height:280,title:$.i18n("workflow.deletePeople.title"),notCopyReturnValue:true,buttons:[{text:$.i18n("common.button.ok.label"),isEmphasize:true,handler:function(){try{var N=G.getReturnValue();if(N!=null&&N.length>0){var O=$.parseJSON(N);var M=O.idArray;if(M.length<=0){$.alert($.i18n("workflow.least.select.one"));return }var P=$("#process_xml");var L=$("#process_message_data");var S="";if(L.size()>0){S=L.val()}var Q=P.val();var U=wfAjax.deleteNode(A,D,I,M,Q,S,getProcessChangeMessage(),H,E);if(U&&U.processXML){P.val(U.processXML);if(L.size()>0){L.val(U.messageDataList);L=null}}if(U&&U.processChangeMessage){setProcessChangeMessage(U.processChangeMessage)}P=null;var T={type:4,currentNodeId:D,names:O.nameArray,messageDataList:U.messageDataList};if(typeof K=="function"){K(T)}else{if(typeof refreshWorkflow=="function"){refreshWorkflow(T)}else{$.alert("\u8bf7\u6dfb\u52a0\u4e00\u4e2a\u540d\u5b57\u4e3arefreshWorkflow\u7684\u51fd\u6570\uff0c\u4ee5\u5237\u65b0\u6d41\u7a0b\u56fe\u9875\u9762\uff0c\u770b\u5230\u52a0\u7b7e/\u51cf\u7b7e\u6548\u679c\uff01")}}}}catch(R){showFlashAlert(R.message)}G.close()}},{text:$.i18n("common.button.cancel.label"),handler:function(){G.close()}}],targetWindow:getCtpTop()})}function getUUID(){var A=new Date().getTime()+""+(UUID_seqence++);if(UUID_seqence>=100000){UUID_seqence=0}return A}var tempSelectPeopleElements=null;var myflowtype="";function createProcessXml(N,M,L,B,U,E,O,H,P,F,D,J,A,T,C){var G=M;if(L){G=L}A=A==undefined?"":A;var I="Department,Team,Post,Outworker,RelatePeople,JoinOrganization";var Q="Account,Department,Team,Post,Outworker,RelatePeople,Member";if(F!=undefined&&F!=null){I=F}if(D!=undefined&&D!=null){Q=D}var S=wfAjax.getAcountExcludeElements();var K=parseElements(S[0]);if(myflowtype==""){if(N=="edocSend"||N=="signReport"||N=="recEdoc"||N=="edoc"||N=="sendInfo"||N=="info"){myflowtype="sequence"}else{myflowtype="concurrent"}myflowtype=C==undefined?myflowtype:C}J=J==undefined?true:J;if(N=="collaboration"){tempSelectPeopleElements=null}var R=$.selectPeople({type:"selectPeople",panels:I,selectType:Q,text:$.i18n("workflow.insertPeople.urgerAlt"),showFlowTypeRadio:true,hiddenColAssignRadio:true,hiddenMultipleRadio:!J,flowtype:myflowtype,mode:A,maxSize:100,targetWindow:M,isConfirmExcludeSubDepartment:true,unallowedSelectEmptyGroup:true,excludeElements:K,params:{value:T==undefined?"":T},elements:tempSelectPeopleElements,callback:function(V){try{if(V.obj&&V.obj[0]){tempSelectPeopleElements=V.obj[0];if(V.obj[1]==0){myflowtype="sequence"}else{myflowtype="concurrent"}}var W=$("#process_info_selectvalue",G.document);var Y=$("#process_info_selectvalue",M.document);W.val(V.value);Y.val(V.value);try{if(getCtpTopFromOpener(window).distroy_token==false){dealSPData2Token("process_info",V)}}catch(X){}}catch(X){}createProcessXmlCallBack(M,V,N,G,B,U,E,O,H,P)}})}function createProcessXmlForward(G,I,H,B,E,D,J){var K="";try{var C=$("#process_info_selectvalue",H.document);var A=$("#process_info_selectvalue",I.document);if(C[0]){K=C.val()}else{K=A.val()}}catch(F){}createProcessXml(G,I,H,"-1","","",D,"-1",J,null,null,B,E,K)}function createProcessXmlCallBack(Z,g,X,k,c,a,j,q,b,d){if(g&&g.obj&&g.obj.length>0&&g.obj[0].length>0){var h=[],V=g.obj[2],m=q,Q=d,x="0",p=g.obj[1],u="all",K="",W="",H="",B="",T="",J="",A="";V=V==undefined?"":V;h.push("<ps>");h.push('<p s="'+V+'" u="" y="0" x="0" i="" n="" d="" t="">');h.push('<n m="0" y="" x="" t="8" d="" n="" i="start">');h.push('<a a="" b="" c="1" d="" e="" f="" g="" i="false" j="false" k=""/>');h.push('<s c="1" r="" e="" f="" g="0" j="multiple" k="" l="" m="false" s="success" d="" t="" n="" i="'+m+'"/>');h.push("</n>");h.push('<n m="0" y="0" x="0" t="4" d="" n="end" i="end">');h.push('<a a="" b="" c="1" d="" e="" f="" g="" i="false" j="false" k=""/>');h.push('<s c="1" r="" e="" f="" g="0" j="multiple" k="" l="" m="false" s="success" d="" t="" n="'+Q+'" i="'+m+'"/>');h.push("</n>");var M=[],O=g.obj[0];for(var s=0,N=O.length;s<N;s++){var I=O[s];var r=getUUID(),K=I.id,W=I.name,H=I.type,B=I.excludeChildDepartment,T=I.accountId,E=I.accountShortname||"";M.push(r);if(H=="Member"){H="user"}B=B==undefined?false:B;var R=1;if(H=="Post"&&T=="-1730833917365171641"){R=2}h.push('<n a="1" b="normal" c="false" l="1000" e="0" t="6" d="" n="'+escapeSpecialChar(W)+'" i="'+r+'">');h.push('<a a="'+escapeSpecialChar(E)+'" b="'+T+'" c="1" d="'+escapeSpecialChar(W)+'" e="" f="'+K+'" h="'+B+'" g="'+H+'" i="false" j="false" k="roleadmin"/>');h.push('<s c="'+R+'" r="" e="" f="" g="0" j="all" k="" l="" m="false" s="success" d="" t="" n="'+Q+'" i="'+m+'"/>');h.push("</n>");if(s<12){if(s>0){A+=$.i18n("workflow.createProcessXml.common_separator_label")}var Y=W;if(E!=null&&E!="null"&&E!="undefined"&&E!=""){Y=Y+"("+E+")"}Y+="("+Q+")";A+=Y}}if(p==0||M.length==1){h.push('<l a="" b="" c="" e="" m="" h="3" o="0" j="'+M[0]+'" k="start" t="11" d="" n="" i="'+getUUID()+'"/>');h.push('<l a="" b="" c="" e="" m="" h="3" o="0" j="end" k="'+M[M.length-1]+'" t="11" d="" n="" i="'+getUUID()+'"/>');for(var s=0;s<M.length-1;s++){var v=M[s];var l=M[s+1];h.push('<l a="" c="" b="" e="" m="" h="3" o="0" j="'+l+'" k="'+v+'" t="11" d="" n="" i="'+getUUID()+'"/>')}}else{var L=getUUID();var o=getUUID();h.push('<n o="" p="true" y="0" x="0" t="2" d="" n="split" i="'+L+'">');h.push('<s c="1" r="" e="" f="" g="0" j="all" k="" l="" m="false" s="success" d="" t="" n="'+Q+'" i="'+m+'"/>');h.push("</n>");h.push('<n o="" p="false" y="0" x="0" t="2" d="" n="join" i="'+o+'">');h.push('<s c="1" r="" e="" f="" g="0" j="all" k="" l="" m="false" s="success" d="" t="" n="'+Q+'" i="'+m+'"/>');h.push("</n>");h.push('<l a="" b="" c="" e="" m="" h="3" o="0" j="'+L+'" k="start" t="11" d="" n="" i="'+getUUID()+'"/>');h.push('<l a="" b="" c="" e="" m="" h="3" o="0" j="end" k="'+o+'" t="11" d="" n="" i="'+getUUID()+'"/>');for(var s=M.length-1;s>=0;s--){var P=M[s];h.push('<l a="" b="" c="" e="" m="" h="3" o="0" j="'+P+'" k="'+L+'" t="11" d="" n="" i="'+getUUID()+'"/>');h.push('<l a="" b="" c="" e="" m="" h="3" o="0" j="'+o+'" k="'+P+'" t="11" d="" n="" i="'+getUUID()+'"/>')}}h.push("</p></ps>");var G=h.join("");var F=$("#process_xml",k.document);if(F.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=process_xml\u7684\u8f93\u5165\u57df\uff01")}F.val(G);var D=$("#process_desc_by",k.document);if(D.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=process_desc_by\u7684\u8f93\u5165\u57df\uff01")}D.val("xml");var C=$("#process_info",k.document);if(C.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=process_info\u7684\u8f93\u5165\u57df\uff01")}C.val(A);F=D=C=null;try{var U=$("#process_desc_by",k.document)[0];var S=$("#process_xml",k.document)[0];var n=$("#process_info",k.document)[0];U.value="xml";S.value=G;n.value=A}catch(w){}if(p==2){createWFPersonal(Z,X,c,a,j,"-1",k,q,b,d)}}}function showFlashAlert(A){try{var C=$.alert(A)}catch(B){C(A)}}function stepBackToTargetNode(P,M,B,I,K,L,R,D,E,F,C,N,G,J){var O=wfAjax.canSpecialStepBack(B);if(O[0]=="false"){$.alert(O[1]);try{releaseApplicationButtons()}catch(Q){}return }var A=lockWorkflow(I,_wfcurrentUserId,10);if(A[0]=="false"){$.alert(A[1]);try{releaseApplicationButtons()}catch(Q){}return false}E=E==undefined?true:E;D=D==undefined?true:D;F=F==undefined?"":F;C=C==undefined?"":C;var H=P;if(M){H=M}_closeFlashDialogBeforeOpen(P);setTimeout(function(){var V=$(P).width();var W=$(P).height();if(V<=0){V=$(document.body).width();W=$(document.body).height()}W=W-50;try{var U=(G==1)?' checked="checked" ':"";var T=(G==1||G==2)?' disabled="true" ':"";var S='<span id="traceSpanArea" style="display:none"><label for="trackWorkflow" class="margin_t_5 hand"><input type="checkbox" id="trackWorkflow" name="trackWorkflow" '+U+T+'class="radio_com">'+$.i18n("collaboration.workflow.trace.traceworkflow")+'</label><span class="color_blue hand" style="color:#318ed9;" title="'+$.i18n("collaboration.workflow.trace.summaryDetail")+'">['+$.i18n("collaboration.workflow.trace.title")+"]</span></span>";S=typeof (J)!="undefined"&&J?S:"";workfowFlashDialog=$.dialog({id:"workflow_dialog_workflowDesigner_Id",isHide:true,bottomHTML:S,url:_wfctxPath+"/workflow/designer.do?method=showDiagram&isDebugger=false&scene=6&isModalDialog=true&processId="+I+"&caseId="+K+"&currentNodeId="+L+"&showToMe="+E+"&showReGo="+D+"&permissionAccountId="+F+"&configCategory="+C+"&isTemplate="+N,width:V-300,height:W-70,title:$.i18n("workflow.special.stepback.title"),transParams:{dwidths:V-270,dheights:W-110,returnValueWindow:H},minParam:{show:false},maxParam:{show:false},closeParam:{show:true,handler:function(){releaseWorkflowByAction(I,_wfcurrentUserId,10);try{releaseApplicationButtons()}catch(Y){}}},targetWindow:P,notCopyReturnValue:true,buttons:[{text:$.i18n("workflow.designer.page.button.ok"),isEmphasize:true,handler:function(){var c=workfowFlashDialog.getReturnValue({innerButtonId:"stepback_ok"});var a=c[0];if(a){var Z=wfAjax.canSpecialStepBack(B);if(Z[0]=="false"){showFlashAlert(Z[1])}else{var Y=c[1];var d=c[2];if(Y=="start"&&d=="0"){var b=$.confirm({msg:$.i18n("workflow.special.stepback.label8"),ok_fn:function(){R(B,I,K,L,c[1],c[2],workfowFlashDialog,c[3],c[4]);releaseWorkflowByAction(I,_wfcurrentUserId,10)},cancel_fn:function(){}})}else{R(B,I,K,L,c[1],c[2],workfowFlashDialog,c[3],c[4]);releaseWorkflowByAction(I,_wfcurrentUserId,10)}}}else{showFlashAlert($.i18n("workflow.special.stepback.label9"))}}},{text:$.i18n("workflow.designer.page.button.cancel"),handler:function(){_closeOrHideFlashDialog();releaseWorkflowByAction(I,_wfcurrentUserId,10);try{releaseApplicationButtons()}catch(Y){}return false}}]})}catch(X){alert(X)}},10)}function multistageSign(T,C,R,L,E,P,M,I,W,F,N,H,S,B,J){var Q=wfAjax.canChangeNode(E);if(Q[0]=="false"){$.alert(Q[1]);return }var D=lockWorkflow(P,_wfcurrentUserId,8);if(D[0]=="false"){$.alert(D[1]);return }var O=H==undefined?"Department":H;var U=S==undefined?"Department,Member":S;var B=B;var G=-1;var A=1;var K=false;var V=$.selectPeople({type:"selectPeople",panels:O,selectType:U,text:$.i18n("workflow.insertPeople.urgerAlt"),showFlowTypeRadio:false,targetWindow:getCtpTop(),departmentId:B+"",unallowedSelectEmptyGroup:true,isNeedCheckLevelScope:K,params:{value:""},callback:function(X){showMultistageSignPageCallBack(X,J,C,R,L,E,P,M,I,W,F,N,T)}})}function escapeSpecialChar(A){if(!A){return A}A=A.replace(/\&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;");A=A.replace(/\'/g,"&#039;").replace(/"/g,"&#034;");return A}function showMultistageSignPageCallBack(K,O,L,G,B,D,A,E,C,H,F,M,J){var N=K.value;var I=$.dialog({url:_wfctxPath+"/workflow/process.do?method=preAddMoreSign&appName="+J+"&flowPermAccountId="+M+"&selObj="+encodeURIComponent(N)+"&nodeId="+E,width:500,height:350,title:$.i18n("workflow.moreSign.findPerson"),minParam:{show:false},maxParam:{show:false},targetWindow:getCtpTop(),notCopyReturnValue:true,buttons:[{text:$.i18n("workflow.designer.page.button.ok"),isEmphasize:true,handler:function(){var U=I.getReturnValue();if(U==false){}else{if(U!=null&&U.length>0){var T=$.parseJSON(U);var S=$("#process_xml");if(S.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=process_xml\u7684\u9690\u85cf\u57df\uff01");return }var V=S.val();var W="";var Q=$("#process_message_data");if(Q.size()>0){W=Q.val()}T.summaryId=L;T.affairId=G;T.currentUserId=C;T.performer=B;T.workitemId=D;T.currentLoginAccountId=F;var P=wfAjax.addNode(A,E,E,B,5,T,V,"",W,getProcessChangeMessage());if("false"==P[2]){$.alert(P[3]);return }if(P&&P[0]){S.val(P[0])}if(P&&P[5]){setProcessChangeMessage(P[5])}if(P&&P[4]&&Q.size()>0){Q.val(P[4]);Q=null}S=null;var R={messageDataList:P[4]};if(typeof O=="function"){O(R)}else{if(typeof refreshWorkflow=="function"){refreshWorkflow(R)}else{$.alert("\u8bf7\u6dfb\u52a0\u4e00\u4e2a\u540d\u5b57\u4e3arefreshWorkflow\u7684\u51fd\u6570\uff0c\u4ee5\u5237\u65b0\u6d41\u7a0b\u56fe\u9875\u9762\uff0c\u770b\u5230\u52a0\u7b7e/\u51cf\u7b7e\u6548\u679c\uff01")}}I.close()}}}},{text:$.i18n("workflow.designer.page.button.cancel"),handler:function(){I.close()}}]})}function passRead(D,A,E,L,J,I,K,F,O,N){var M=wfAjax.canChangeNode(D);if(M[0]=="false"){$.alert(M[1]);return }var G=lockWorkflow(A,_wfcurrentUserId,7);if(G[0]=="false"){$.alert(G[1]);return }var H=wfAjax.getAcountExcludeElements();var C=parseElements(H[0]);var B={type:"selectPeople",text:$.i18n("workflow.insertPeople.urgerAlt"),showFlowTypeRadio:false,isConfirmExcludeSubDepartment:true,excludeElements:C,params:{value:""},departmentId:O+"",unallowedSelectEmptyGroup:true,targetWindow:getCtpTop(),callback:function(g){if(g&&g.obj&&g.obj.length>0){var X=[],R=[],f=[],Q=[],U=[],S=[],a=[];var e={};for(var b=0,c=g.obj.length;b<c;b++){X.push(g.obj[b].id);R.push(g.obj[b].name);f.push(g.obj[b].type);Q.push(g.obj[b].excludeChildDepartment);U.push(g.obj[b].accountId);S.push(g.obj[b].accountShortname);a.push("all")}e.userId=X;e.userName=R;e.userType=f;e.userExcludeChildDepartment=Q;e.accountId=U;e.accountShortname=S;e.node_process_mode=a;var Z=$("#process_xml"),P=$("#readyObjectJSON");if(Z.size()<=0){$.alert("\u8bf7\u6dfb\u52a0id=process_xml\u7684\u9690\u85cf\u57df\uff01");return }var d=Z.val();var T=$("#process_message_data");var W="";if(T.size()>0){W=T.val()}e.summaryId=K;e.affairId=F;var V=wfAjax.addNode(A,E,E,L,6,e,d,"",W,getProcessChangeMessage());if(V&&V[0]){Z.val(V[0])}if(V&&V[4]&&T.size()>0){T.val(V[4]);T=null}if(V&&V[5]){setProcessChangeMessage(V[5])}Z=null;var Y={messageDataList:V[4]};if(typeof N=="function"){N(Y)}else{if(typeof refreshWorkflow=="function"){refreshWorkflow(Y)}else{$.alert("\u8bf7\u6dfb\u52a0\u4e00\u4e2a\u540d\u5b57\u4e3arefreshWorkflow\u7684\u51fd\u6570\uff0c\u4ee5\u5237\u65b0\u6d41\u7a0b\u56fe\u9875\u9762\uff0c\u770b\u5230\u52a0\u7b7e/\u51cf\u7b7e\u6548\u679c\uff01")}}}else{$("#collSelectPeopleInput").val("<"+$.i18n("workflow.insertPeople.urgerAlt")+">")}}};B.panels="Department,Team";B.selectType="Account,Department,Team,Member";$.selectPeople(B)}function replaceTemplateNode(D,A,C,B){B=B||{};window.templateReplaceNodeDialog=$.dialog({id:"templateReplaceNode",url:_ctxPath+"/workflow/replace.do?method=index&appName="+A,width:700,height:475,title:C||$.i18n("workflow.replaceNode.40"),minParam:{show:false},maxParam:{show:false},transParams:{paramWin:window,initData:B.datas,initType:B.type},close_fn:function(){window.dialog.transParams=null},targetWindow:getCtpTop()});D=null}function executeWorkflowBeforeEvent(B,J,H,M,A,C,F,K,E,N,G,L){if(M==null||M==""||hasWorkflowEvent=="false"||hasWorkflowEvent==false){removeWorkflowMatchResultCache();return true}var D=new Object();D.formData=F;D.mastrid=F;D.processTemplateId=M;D.processId=A;D.currentActivityId=C;D.bussinessId=J;D.affairId=H;D.appName=K;D.formAppId=E;D.formId=N;D.formOperationId=G;D.matchRequestToken=matchRequestToken;D.processXml=L;var O=wfAjax.executeWorkflowBeforeEvent(B,D);if(O&&O!=""){$.alert(O);try{releaseApplicationButtons()}catch(I){}return false}return true};